<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>MFS Portal</title>
    <!-- Inter font (added) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <!-- svg4everybody polyfill for external SVG support in older browsers -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/svg4everybody/2.1.9/svg4everybody.min.js"></script>
    <script>svg4everybody();</script>
    <!-- Salesforce Canvas SDK -->
    <!-- <script src="/canvas-all.js"></script> -->
     <!-- Salesforce Canvas SDK -->
  <script src="https://mfsuk--dev.sandbox.lightning.force.com/canvas/sdk/js/canvas-all.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/index.jsx"></script>
 <script>
    // Initialize from server-side envelope parameters
    let params = {};
    try {
      //alert('new Raghu alert');
      //params = JSON.parse('<%- params %>');
      alert('raghu1' + Sfdc.canvas.data.payload);
    } catch(e) {
      console.warn('No params found in signed_request context');
      params = {};
    }

    //console.log("Initial Canvas Parameters:", params);

 
    const isCanvasAvailable = !!(
        typeof Sfdc !== 'undefined' &&
        Sfdc.canvas &&
        Sfdc.canvas.client
      );
    console.log("Is Salesforce Canvas SDK available?", isCanvasAvailable);
    //alert('raghu-canvas' + isCanvasAvailable);
    // Handle dynamic refresh (postMessage from VF Canvas parent)
    if (typeof Sfdc !== 'undefined' && Sfdc.canvas && Sfdc.canvas.client) {
      console.log('Canvas SDK available, subscribing to refresh event...');
      alert('raghu' + data.payload);
      Sfdc.canvas.client.subscribe(window.parent, [
        {
          name: 'refresh',
          onData: function (data) {
            console.log('Received refresh payload from VF:', data.payload);
            params = data.payload || {};
            // Update dropdowns to reflect new values
            if (params.productType) document.getElementById('productType').value = params.productType;
            if (params.propertyType) document.getElementById('propertyType').value = params.propertyType;

            // Optionally auto-fetch products
           // fetchProducts(params);

          }
        }
      ]);
    } else {
      console.warn('Salesforce Canvas SDK not detected.');
    }
  </script>


  </body>
</html>